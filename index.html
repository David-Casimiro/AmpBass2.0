<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0"/>
<title>Q-16 Live Synth FX</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body{background:#020617;color:#e5e7eb;font-family:system-ui}
.card{background:#020617;border:1px solid #1e293b;border-radius:14px;padding:12px}
.key{touch-action:none}
.white{background:#fff;color:#000;width:38px;height:68px;
  display:inline-flex;align-items:center;justify-content:center;
  margin-right:5px;border-radius:6px;font-weight:bold}
input[type=range]{width:100%}
</style>
</head>

<body class="p-4 max-w-lg mx-auto">

<header class="text-center mb-3">
<h1 class="text-xl font-bold">ðŸŽ¹ Synth Live FX</h1>
<p class="text-xs text-gray-400">Chorus â€¢ Phaser â€¢ Q-16 â€¢ Safari</p>
</header>

<section class="card mb-3">
<button id="start" class="w-full py-2 bg-green-600 rounded font-bold">
INICIAR
</button>

<label class="text-xs mt-2">Master</label>
<input id="master" type="range" min="0" max="1.5" step="0.01" value="0.9">
</section>

<section class="card mb-3">
<h2 class="text-sm font-bold mb-2">Synth</h2>

<select id="wave" class="w-full mb-2 bg-black/30 p-2 rounded">
<option value="sine">Sine</option>
<option value="sawtooth">Saw</option>
<option value="square">Square</option>
<option value="triangle">Triangle</option>
</select>

<label class="text-xs">Attack</label>
<input id="att" type="range" min="0" max="200" value="20">

<label class="text-xs mt-1">Release</label>
<input id="rel" type="range" min="50" max="1200" value="350">
</section>

<section class="card mb-3">
<h2 class="text-sm font-bold mb-2">FX â€“ Synth</h2>

<label class="text-xs">Reverb</label>
<input id="rev" type="range" min="0" max="1" step="0.01" value="0.25">

<label class="text-xs mt-1">Delay</label>
<input id="dSend" type="range" min="0" max="1" step="0.01" value="0.2">

<label class="text-xs mt-1">Chorus</label>
<input id="chorusSend" type="range" min="0" max="1" step="0.01" value="0.3">

<label class="text-xs mt-1">Phaser</label>
<input id="phaserSend" type="range" min="0" max="1" step="0.01" value="0.25">
</section>

<section class="card">
<h2 class="text-sm font-bold mb-2">Teclado</h2>
<div id="keys" class="flex"></div>
</section>

<script>
let ctx, masterGain, synthBus;
let reverbGain, delayGain;
let chorusGain, phaserGain;
let delay, delayFB;

// ======================= TECLADO =======================
const notes=[261,293,329,349,392,440,493];
const keys=document.getElementById("keys");
let voices={};

notes.forEach((f,i)=>{
 let k=document.createElement("div");
 k.className="white key";
 k.textContent=String.fromCharCode(67+i);
 k.onpointerdown=()=>noteOn(f,i);
 k.onpointerup=()=>noteOff(i);
 keys.appendChild(k);
});

// ======================= START =======================
document.getElementById("start").onclick=()=>{
 ctx=new AudioContext({latencyHint:"interactive",sampleRate:48000});

 masterGain=ctx.createGain();
 masterGain.gain.value=0.9;
 masterGain.connect(ctx.destination);

 synthBus=ctx.createGain();
 synthBus.connect(masterGain);

 setupReverb();
 setupDelay();
 setupChorus();
 setupPhaser();
};

// ======================= SYNTH =======================
function noteOn(freq,id){
 let osc=ctx.createOscillator();
 let g=ctx.createGain();
 osc.type=wave.value;
 osc.frequency.value=freq;
 osc.connect(g).connect(synthBus);

 // sends
 g.connect(reverbGain);
 g.connect(delayGain);
 g.connect(chorusGain);
 g.connect(phaserGain);

 let now=ctx.currentTime;
 g.gain.setValueAtTime(0,now);
 g.gain.linearRampToValueAtTime(1,now+att.value/1000);
 osc.start();
 voices[id]={osc,g};
}

function noteOff(id){
 let v=voices[id];
 if(!v) return;
 let now=ctx.currentTime;
 v.g.gain.linearRampToValueAtTime(0,now+rel.value/1000);
 setTimeout(()=>v.osc.stop(),rel.value+50);
 delete voices[id];
}

// ======================= REVERB =======================
function setupReverb(){
 const convolver=ctx.createConvolver();
 const ir=ctx.createBuffer(2,48000,48000);
 for(let c=0;c<2;c++){
  const d=ir.getChannelData(c);
  for(let i=0;i<d.length;i++){
   d[i]=(Math.random()*2-1)*Math.pow(1-i/d.length,2);
  }
 }
 convolver.buffer=ir;
 reverbGain=ctx.createGain();
 reverbGain.gain.value=0.25;
 reverbGain.connect(convolver).connect(synthBus);
}

// ======================= DELAY =======================
function setupDelay(){
 delay=ctx.createDelay(1);
 delay.delayTime.value=0.25;
 delayFB=ctx.createGain();
 delayFB.gain.value=0.35;
 delayGain=ctx.createGain();
 delayGain.gain.value=0.2;

 delay.connect(delayFB).connect(delay);
 delay.connect(synthBus);
 delayGain.connect(delay);
}

// ======================= CHORUS =======================
function setupChorus(){
 const chorusDelay=ctx.createDelay(0.05);
 chorusDelay.delayTime.value=0.015;

 const lfo=ctx.createOscillator();
 const lfoGain=ctx.createGain();
 lfo.frequency.value=0.8;      // lento (estÃ¡vel p/ palco)
 lfoGain.gain.value=0.005;

 lfo.connect(lfoGain).connect(chorusDelay.delayTime);
 lfo.start();

 chorusGain=ctx.createGain();
 chorusGain.gain.value=0.3;
 chorusGain.connect(chorusDelay).connect(synthBus);
}

// ======================= PHASER =======================
function setupPhaser(){
 let input=ctx.createGain();
 let last=input;

 for(let i=0;i<4;i++){
  const ap=ctx.createBiquadFilter();
  ap.type="allpass";
  ap.frequency.value=700 + i*400;
  last.connect(ap);
  last=ap;
 }

 const lfo=ctx.createOscillator();
 const lfoGain=ctx.createGain();
 lfo.frequency.value=0.5;
 lfoGain.gain.value=600;

 lfo.connect(lfoGain);
 lfo.start();
 lfoGain.connect(last.frequency);

 phaserGain=ctx.createGain();
 phaserGain.gain.value=0.25;
 phaserGain.connect(input);
 last.connect(synthBus);
}

// ======================= CONTROLES =======================
master.oninput=e=>masterGain&&(masterGain.gain.value=e.target.value);
rev.oninput=e=>reverbGain&&(reverbGain.gain.value=e.target.value);
dSend.oninput=
