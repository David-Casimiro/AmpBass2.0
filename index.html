<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0"/>
<title>Q-16 Live Synth FX</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body{background:#020617;color:#e5e7eb;font-family:system-ui}
.card{background:#020617;border:1px solid #1e293b;border-radius:14px;padding:12px}
canvas{background:#000;border-radius:8px;width:100%;height:100px}
.key{touch-action:none}
.white{background:#fff;color:#000;width:36px;height:64px;display:inline-flex;align-items:center;justify-content:center;margin-right:4px;border-radius:4px}
.black{background:#000;color:#fff;width:24px;height:40px;margin-left:-16px;z-index:2;border-radius:3px}
input[type=range]{width:100%}
</style>
</head>

<body class="p-4 max-w-lg mx-auto">

<header class="text-center mb-3">
<h1 class="text-xl font-bold">ðŸŽ¹ Synth Live FX</h1>
<p class="text-xs text-gray-400">Q-16 â€¢ iPhone â€¢ Safari</p>
</header>

<section class="card mb-3">
<button id="start" class="w-full py-2 bg-green-600 rounded font-bold">INICIAR</button>

<div class="mt-2">
<label class="text-xs">Master</label>
<input id="master" type="range" min="0" max="1.5" step="0.01" value="0.9">
</div>
</section>

<section class="card mb-3">
<h2 class="text-sm font-bold mb-1">Synth</h2>

<select id="wave" class="w-full mb-2 bg-black/30 p-2 rounded">
<option value="sine">Sine</option>
<option value="sawtooth">Saw</option>
<option value="square">Square</option>
<option value="triangle">Triangle</option>
</select>

<div class="grid grid-cols-2 gap-2 text-xs">
<div>Attack <input id="att" type="range" min="0" max="200" value="10"></div>
<div>Release <input id="rel" type="range" min="10" max="1000" value="200"></div>
</div>
</section>

<section class="card mb-3">
<h2 class="text-sm font-bold mb-1">FX â€“ Synth</h2>

<label class="text-xs">Reverb</label>
<input id="rev" type="range" min="0" max="1" step="0.01" value="0.3">

<label class="text-xs mt-1">Delay Send</label>
<input id="dSend" type="range" min="0" max="1" step="0.01" value="0.25">

<label class="text-xs mt-1">Delay Time (ms)</label>
<input id="dTime" type="range" min="80" max="600" value="280">

<label class="text-xs mt-1">Delay Feedback</label>
<input id="dFb" type="range" min="0" max="0.8" step="0.01" value="0.35">
</section>

<section class="card">
<h2 class="text-sm mb-2 font-bold">Teclado</h2>
<div id="keys" class="flex"></div>
</section>

<script>
let ctx, masterGain, synthBus, delay, delayFB, delayGain, reverbGain;

const notes = [
{n:"C",f:261},{n:"D",f:293},{n:"E",f:329},{n:"F",f:349},
{n:"G",f:392},{n:"A",f:440},{n:"B",f:493}
];

const keysDiv=document.getElementById("keys");
notes.forEach((o,i)=>{
 let k=document.createElement("div");
 k.className="white key";
 k.textContent=o.n;
 k.onpointerdown=()=>noteOn(o.f,i);
 k.onpointerup=()=>noteOff(i);
 keysDiv.appendChild(k);
});

let voices={};

document.getElementById("start").onclick=async()=>{
ctx=new AudioContext({latencyHint:"interactive",sampleRate:48000});

masterGain=ctx.createGain();
masterGain.gain.value=0.9;
masterGain.connect(ctx.destination);

synthBus=ctx.createGain();
synthBus.connect(masterGain);

// REVERB
const ir=ctx.createBuffer(2,48000,48000);
for(let c=0;c<2;c++){
 let d=ir.getChannelData(c);
 for(let i=0;i<d.length;i++){
  d[i]=(Math.random()*2-1)*Math.pow(1-i/d.length,2);
 }
}
const convolver=ctx.createConvolver();
convolver.buffer=ir;

reverbGain=ctx.createGain();
reverbGain.gain.value=0.3;
convolver.connect(reverbGain).connect(synthBus);

// DELAY
delay=ctx.createDelay(1);
delay.delayTime.value=0.28;
delayFB=ctx.createGain();
delayFB.gain.value=0.35;
delayGain=ctx.createGain();
delayGain.gain.value=0.25;

delay.connect(delayFB).connect(delay);
delay.connect(delayGain).connect(synthBus);

// Synth dry â†’ fx
synthBus.connect(convolver);
synthBus.connect(delay);

};

function noteOn(freq,id){
 let osc=ctx.createOscillator();
 let g=ctx.createGain();
 osc.type=wave.value;
 osc.frequency.value
