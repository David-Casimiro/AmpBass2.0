<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Stage Synth Mobile</title>

<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="theme-color" content="#020617">

<script src="https://cdn.tailwindcss.com"></script>

<style>
html,body{
 background:#020617;
 color:#e5e7eb;
 font-family:system-ui,-apple-system,sans-serif;
 touch-action:manipulation;
}
.section{
 border:1px solid #1e293b;
 border-radius:16px;
 padding:1rem;
}
label{
 font-size:.7rem;
 color:#9ca3af;
}
input[type=range]{ width:100% }
button:active{ transform:scale(.96) }
</style>
</head>

<body class="p-3 max-w-md mx-auto">

<header class="text-center mb-3">
 <h1 class="text-xl font-bold">ðŸŽ¹ Stage Synth</h1>
 <p class="text-[10px] text-gray-400">Live â€¢ Mobile â€¢ Safari</p>
</header>

<!-- POWER -->
<section class="grid grid-cols-2 gap-3 mb-3">
 <button id="powerBtn" class="py-4 rounded-xl bg-green-700 font-bold">LIGAR</button>
 <button id="inputBtn" class="py-4 rounded-xl bg-yellow-500 font-bold text-black">INPUT ON</button>
</section>

<!-- MASTER -->
<section class="section mb-3">
 <label>MASTER</label>
 <input id="master" type="range" min="0" max="1.2" step="0.01" value="0.8">
</section>

<!-- PRESETS -->
<section class="section mb-3">
 <label>PRESET</label>
 <div class="flex gap-2">
  <select id="presetList" class="flex-1 bg-black border border-slate-700 rounded p-2 text-sm"></select>
  <button id="savePreset" class="px-3 bg-blue-600 rounded">SALVAR</button>
 </div>
</section>

<!-- FILTER -->
<section class="section mb-3">
 <label>FILTER CUTOFF</label>
 <input id="filterCutoff" type="range" min="100" max="8000" step="10" value="2000">
</section>

<!-- TREMOLO -->
<section class="section mb-3">
 <label class="flex justify-between">
  <span>TREMOLO MIX</span><span id="tremoloMixVal">20%</span>
 </label>
 <input id="tremoloMix" type="range" min="0" max="1" step="0.01" value="0.2">
</section>

<!-- PHASER -->
<section class="section mb-3">
 <label class="flex justify-between">
  <span>PHASER MIX</span><span id="phaserMixVal">15%</span>
 </label>
 <input id="phaserMix" type="range" min="0" max="1" step="0.01" value="0.15">
</section>

<!-- DELAY -->
<section class="section mb-3">
 <label class="flex justify-between">
  <span>DELAY MIX</span><span id="delayMixVal">25%</span>
 </label>
 <input id="delayMix" type="range" min="0" max="1" step="0.01" value="0.25">
</section>

<!-- REVERB -->
<section class="section mb-4">
 <label class="flex justify-between">
  <span>REVERB MIX</span><span id="reverbMixVal">30%</span>
 </label>
 <input id="reverbMix" type="range" min="0" max="1" step="0.01" value="0.3">
</section>

<footer class="text-center text-[9px] text-gray-500">
 Stage Synth â€¢ WebAudio â€¢ USB Audio â€¢ PWA Ready
</footer>

<script>
/* ================= UTILS ================= */
const el=id=>document.getElementById(id);
const pct=v=>Math.round(v*100)+"%";

/* ================= AUDIO ================= */
let ctx, input, running=false, inputOn=true;
let filter, master;
let tremoloGain, tremoloLFO;
let phaserDelay, phaserLFO;
let delay, delayMixGain;
let reverb, reverbMixGain;

/* ================= INIT ================= */
el("powerBtn").onclick=async ()=>{
 if(!running){
  ctx=new AudioContext({ latencyHint:"interactive" });
  const stream=await navigator.mediaDevices.getUserMedia({
   audio:{ channelCount:1, echoCancellation:false, noiseSuppression:false }
  });

  input=ctx.createMediaStreamSource(stream);

  filter=ctx.createBiquadFilter();
  filter.type="lowpass";

  tremoloGain=ctx.createGain();
  tremoloLFO=ctx.createOscillator();
  tremoloLFO.frequency.value=5;

  phaserDelay=ctx.createDelay();
  phaserDelay.delayTime.value=0.003;
  phaserLFO=ctx.createOscillator();
  phaserLFO.frequency.value=0.6;

  delay=ctx.createDelay();
  delay.delayTime.value=.35;
  delayMixGain=ctx.createGain();

  reverbMixGain=ctx.createGain();
  reverb=ctx.createConvolver();
  createReverb();

  master=ctx.createGain();

  tremoloLFO.connect(tremoloGain.gain);
  phaserLFO.connect(phaserDelay.delayTime);

  input.connect(filter);
  filter.connect(tremoloGain);
  tremoloGain.connect(phaserDelay);
  phaserDelay.connect(delay);
  delay.connect(delayMixGain);
  delayMixGain.connect(reverbMixGain);
  reverbMixGain.connect(master);
  master.connect(ctx.destination);

  tremoloLFO.start();
  phaserLFO.start();

  running=true;
  el("powerBtn").textContent="DESLIGAR";
  el("powerBtn").classList.replace("bg-green-700","bg-red-700");
  update();
 } else {
  ctx.close(); running=false;
  el("powerBtn").textContent="LIGAR";
  el("powerBtn").classList.replace("bg-red-700","bg-green-700");
 }
};

/* ================= CONTROLS ================= */
function update(){
 if(!running) return;
 filter.frequency.value=el("filterCutoff").value;
 tremoloGain.gain.value=el("tremoloMix").value;
 delayMixGain.gain.value=el("delayMix").value;
 reverbMixGain.gain.value=el("reverbMix").value;
 master.gain.value=el("master").value;
}

/* ================= PERCENT UI ================= */
["tremolo","phaser","delay","reverb"].forEach(n=>{
 el(n+"Mix").oninput=e=>{
  el(n+"MixVal").textContent=pct(e.target.value);
  update();
 };
});

["filterCutoff","master"].forEach(id=>el(id).oninput=update);

/* ================= PRESETS ================= */
function savePreset(){
 const p={
  filter:el("filterCutoff").value,
  tremolo:el("tremoloMix").value,
  phaser:el("phaserMix").value,
  delay:el("delayMix").value,
  reverb:el("reverbMix").value,
  master:el("master").value
 };
 const name=prompt("Preset:");
 if(!name) return;
 localStorage.setItem("preset_"+name,JSON.stringify(p));
 loadPresets();
}

function loadPresets(){
 const sel=el("presetList");
 sel.innerHTML="";
 Object.keys(localStorage).filter(k=>k.startsWith("preset_"))
 .forEach(k=>{
  const o=document.createElement("option");
  o.value=k; o.text=k.replace("preset_","");
  sel.appendChild(o);
 });
}

el("savePreset").onclick=savePreset;
el("presetList").onchange=e=>{
 const p=JSON.parse(localStorage.getItem(e.target.value));
 el("filterCutoff").value=p.filter;
 el("tremoloMix").value=p.tremolo;
 el("delayMix").value=p.delay;
 el("reverbMix").value=p.reverb;
 el("master").value=p.master;
 ["tremolo","delay","reverb"].forEach(n =>
  el(n+"MixVal").textContent=pct(el(n+"Mix").value)
 );
 update();
};

loadPresets();

/* ================= REVERB ================= */
function createReverb(){
 const len=ctx.sampleRate*1.5;
 const buf=ctx.createBuffer(2,len,ctx.sampleRate);
 for(let c=0;c<2;c++){
  const d=buf.getChannelData(c);
  for(let i=0;i<len;i++)
   d[i]=(Math.random()*2-1)*(1-i/len);
 }
 reverb.buffer=buf;
}
</script>

</body>
</html>
